<?xml version="1.0" encoding="UTF-8"?>
<root>
	<windowclass name="npc_combat_actions" merge="join">
		<script file="campaign/scripts/npc_main.lua" />
		<sheetdata>
			<header_content_framed_headersimple name="header_resources" insertbefore="traits_header">
				<static textres="power_header_resources"/>
			</header_content_framed_headersimple>
			<button_iedit name="resources_iedit">
				<anchored to="header_resources" position="righthigh" offset="-20,0" />
				<target>resources</target>
			</button_iedit>
			<button_iadd name="resources_iadd">
				<anchored to="resources_iedit" position="lefthigh" offset="5,0" />
				<target>resources</target>
			</button_iadd>
			<list_npcactions name="resources" insertbefore="traits_header">
				<datasource>.resources</datasource>
				<class>resource_item</class>
				<sortby><field>name</field></sortby>
			</list_npcactions>
		</sheetdata>
	</windowclass>

	<windowclass name="npc_power" merge="join">
		<sheetdata>
			<stringfield name="name">
				<script>
					function onDoubleClick(x, y)
						local sName = getValue();
						local sValue, sResource = sName:match("%((%d) ([^%)]+)%)");
						local nodeActor = DB.getChild(getDatabaseNode(), "....");
						for _,nodeResource in pairs(DB.getChildren(nodeActor, "resources")) do
							if sResource == DB.getValue(nodeResource, "name") then
								rActor = ActorManager.resolveActor(nodeActor)
								local rAction = {};
								rAction.type = "resource";
								rAction.operation = "";
								rAction.label = sName;
								rAction.resource = sResource;
								rAction.modifier = tonumber(sValue);
								rAction.dice = {};
								rRoll = ActionResource.getRoll(rActor, rAction);
								if rRoll then
									ActionsManager.performMultiAction(nil, rActor, rRoll.sType, {rRoll});
								end
							end
						end
					end
				</script>
			</stringfield>
		</sheetdata>
	</windowclass>
</root>